<!DOCTYPE html>
<html lang="uk" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ê–≤—Ç–æ–õ—ñ–∫–∞—Ä24.7</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="manifest" href="/manifest.webmanifest.json">
    <style>
      :root {
        --background-dark: #1a1a1a;
        --background-light: #f5f5f5;
        --text-dark: #fff;
        --text-light: #333;
        --primary-color: #ff3300;
        --secondary-color: #ff6600;
        --accent-color: #007bff;
        --footer-bg-dark: #222;
        --footer-bg-light: #e0e0e0;
      }

      html {
        scroll-behavior: smooth;
        height: 100%;
      }

      body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        background: var(--background-dark);
        background-image: radial-gradient(
            rgba(255, 0, 0, 0.1) 1px,
            transparent 1px
          ),
          radial-gradient(rgba(255, 0, 0, 0.1) 1px, transparent 1px);
        background-size: 50px 50px;
        background-position: 0 0, 25px 25px;
        padding: 0;
        color: var(--text-dark);
        font-family: "Roboto", Arial, sans-serif;
        transition: background 0.3s ease, color 0.3s ease;
        margin: 0;
        overflow-x: hidden;
      }

      html.light body {
        background: var(--background-light);
        color: var(--text-light);
      }

      .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        flex: 1;
      }

      header {
        width: 100%;
        background: linear-gradient(145deg, #222222, #333333);
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        margin-bottom: 20px;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
        transition: all 0.3s ease;
      }

      html.light header {
        background: linear-gradient(145deg, #e0e0e0, #f0f0f0);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary-color);
        text-decoration: none;
      }

      .nav-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      button {
        padding: 10px 15px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }

      .theme-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 30px;
        margin: 0 10px;
      }

      .theme-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #333;
        transition: 0.4s;
        border-radius: 30px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 5px;
      }

      html.light .slider {
        background-color: #ccc;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: var(--primary-color);
      }

      input:checked + .slider:before {
        transform: translateX(30px);
      }

      .slider .sun,
      .slider .moon {
        color: #ffffff;
        font-size: 14px;
      }

      main {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        flex: 1;
      }

      /* –°—Ç–∏–ª—ñ –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ */
      .charts-row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        margin-top: 30px;
      }

      .chart-container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        flex: 1;
        min-width: 300px;
        max-width: calc(50% - 10px);
      }

      html.light .chart-container {
        background: rgba(0, 0, 0, 0.05);
      }

      .chart-title {
        text-align: center;
        margin-bottom: 20px;
        font-size: 1.5rem;
        color: var(--primary-color);
      }

      .chart-wrapper {
        position: relative;
        height: 300px;
      }

      /* –°—Ç–∏–ª—ñ –¥–ª—è —Ñ—É—Ç–µ—Ä–∞ */
      footer {
        width: 100%;
        background-color: var(--footer-bg-dark);
        color: var(--text-dark);
        padding: 30px 0;
        margin-top: 40px;
      }

      html.light footer {
        background-color: var(--footer-bg-light);
        color: var(--text-light);
      }

      .footer-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .footer-section {
        flex: 1;
        min-width: 250px;
        margin-bottom: 20px;
        padding: 0 15px;
      }

      .footer-section h3 {
        color: var(--primary-color);
        margin-bottom: 15px;
        font-size: 1.2rem;
      }

      .footer-section ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .footer-section ul li {
        margin-bottom: 8px;
      }

      .footer-section a {
        color: var(--text-dark);
        text-decoration: none;
        transition: color 0.3s ease;
      }

      html.light .footer-section a {
        color: var(--text-light);
      }

      .footer-section a:hover {
        color: var(--primary-color);
        text-decoration: underline;
      }

      .social-icons {
        display: flex;
        gap: 15px;
        margin-top: 15px;
      }

      .social-icons a {
        display: inline-block;
        width: 36px;
        height: 36px;
        background-color: var(--primary-color);
        border-radius: 50%;
        color: white;
        text-align: center;
        line-height: 36px;
        transition: transform 0.3s ease, background-color 0.3s ease;
      }

      .social-icons a:hover {
        transform: translateY(-3px);
        background-color: var(--secondary-color);
      }

      .copyright {
        text-align: center;
        padding-top: 20px;
        margin-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.9rem;
      }

      html.light .copyright {
        border-top: 1px solid rgba(0, 0, 0, 0.1);
      }

      /* –°—Ç–∏–ª—ñ –¥–ª—è —Ñ–æ—Ä–º–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è */
      .order-form-container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        margin-top: 30px;
        margin-bottom: 30px;
      }

      html.light .order-form-container {
        background: rgba(0, 0, 0, 0.05);
      }

      .order-form-title {
        text-align: center;
        margin-bottom: 20px;
        font-size: 1.8rem;
        color: var(--primary-color);
      }

      .order-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .form-group label {
        font-weight: 600;
        font-size: 1rem;
      }

      .form-group input,
      .form-group textarea {
        padding: 12px;
        border-radius: 5px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background-color: rgba(0, 0, 0, 0.2);
        color: var(--text-dark);
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      html.light .form-group input,
      html.light .form-group textarea {
        border: 1px solid rgba(0, 0, 0, 0.2);
        background-color: rgba(255, 255, 255, 0.8);
        color: var(--text-light);
      }

      .form-group input:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(255, 51, 0, 0.3);
      }

      .form-group textarea {
        min-height: 120px;
        resize: vertical;
      }

      .submit-btn {
        padding: 12px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 10px;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }

      .submit-btn:disabled {
        background: #888;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .form-message {
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        margin-top: 15px;
        display: none;
      }

      .form-message.success {
        background-color: rgba(0, 255, 0, 0.2);
        color: #00ff00;
        display: block;
      }

      .form-message.error {
        background-color: rgba(255, 0, 0, 0.2);
        color: #ff0000;
        display: block;
      }

      /* –°—Ç–∏–ª—ñ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
      .stats-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        margin-top: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        flex: 1;
        min-width: 200px;
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      html.light .stat-card {
        background: rgba(0, 0, 0, 0.05);
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--primary-color);
        margin: 10px 0;
      }

      .stat-label {
        font-size: 1rem;
        color: var(--text-dark);
        margin-bottom: 5px;
      }

      html.light .stat-label {
        color: var(--text-light);
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
      @media (max-width: 992px) {
        .chart-container {
          max-width: 100%;
        }
      }

      @media (max-width: 768px) {
        header {
          flex-direction: column;
          align-items: stretch;
        }

        .nav-buttons {
          flex-direction: column;
          width: 100%;
        }

        button {
          width: 100%;
        }

        .theme-switch-container {
          display: flex;
          justify-content: center;
          margin-top: 10px;
        }

        .chart-wrapper {
          height: 250px;
        }

        .footer-section {
          flex: 100%;
          text-align: center;
        }

        .social-icons {
          justify-content: center;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 0;
        }

        .container {
          padding: 0 10px;
        }

        header {
          padding: 10px;
          border-radius: 0;
          margin-bottom: 10px;
        }

        .logo {
          font-size: 1.2rem;
        }

        button {
          font-size: 0.8rem;
          padding: 8px 12px;
        }

        main {
          padding: 10px;
        }

        .chart-wrapper {
          height: 200px;
        }

        h1 {
          font-size: 1.5rem;
        }

        .chart-title {
          font-size: 1.2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <a href="index.html" class="logo">ProFix Network Hub</a>
        <div class="nav-buttons">
          <button id="profileBtn">–ü—Ä–æ—Ñ—ñ–ª—å</button>
          <button id="registerBtn">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —Ç–∞ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è</button>
          <button id="adminBtn">–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</button>
        </div>
        <div class="theme-switch-container">
          <label class="theme-switch">
            <input type="checkbox" id="themeToggle" />
            <span class="slider">
              <span class="moon">üåô</span>
              <span class="sun">‚òÄÔ∏è</span>
            </span>
          </label>
        </div>
      </header>

      <main>
        <h1>–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ ProFix Network Hub</h1>
        <p>–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –Ω–∞–π–∫—Ä–∞—â—ñ –ø–æ—Å–ª—É–≥–∏ –¥–ª—è –≤–∞—à–æ–≥–æ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è.</p>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ -->
        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-label">–°–µ—Ä–µ–¥–Ω—ñ–π –≤—ñ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</div>
            <div class="stat-value" id="averageAgeValue">--</div>
            <div class="stat-label">—Ä–æ–∫—ñ–≤</div>
          </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è -->
        <div class="order-form-container">
          <h2 class="order-form-title">–ó–∞–ª–∏—à–∏—Ç–∏ –∑–∞—è–≤–∫—É –ø—Ä–æ –¥–æ–ø–æ–º–æ–≥—É</h2>
          <form id="orderForm" class="order-form">
            <div class="form-group">
              <label for="orderTitle">–¢–µ–º–∞ –∑–∞—è–≤–∫–∏*</label>
              <input
                type="text"
                id="orderTitle"
                name="title"
                required
                placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ó–∞–º—ñ–Ω–∞ –º–∞—Å–ª–∞"
              />
            </div>
            <div class="form-group">
              <label for="orderDescription">–û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏</label>
              <textarea
                id="orderDescription"
                name="description"
                placeholder="–î–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É"
              ></textarea>
            </div>
            <div class="form-group">
              <label for="orderPhone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É*</label>
              <input
                type="tel"
                id="orderPhone"
                name="phone"
                required
                placeholder="+380XXXXXXXXX"
              />
            </div>
            <button type="submit" class="submit-btn" id="submitOrderBtn">
              –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞—è–≤–∫—É
            </button>
            <div id="orderFormMessage" class="form-message"></div>
          </form>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤ –æ–¥–∏–Ω —Ä—è–¥ -->
        <div class="charts-row">
          <!-- –ì—Ä–∞—Ñ—ñ–∫ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –º–∞–π—Å—Ç—Ä—ñ–≤ -->
          <div class="chart-container">
            <h2 class="chart-title">–î–∏–Ω–∞–º—ñ–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –º–∞–π—Å—Ç—Ä—ñ–≤</h2>
            <div class="chart-wrapper">
              <canvas id="userMasterChart"></canvas>
            </div>
          </div>

          <!-- –ì—Ä–∞—Ñ—ñ–∫ –≤—ñ–∫–æ–≤–æ—ó —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
          <div class="chart-container">
            <h2 class="chart-title">–í—ñ–∫–æ–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h2>
            <div class="chart-wrapper">
              <canvas id="ageChart"></canvas>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <footer>
      <div class="footer-container">
        <div class="footer-section">
          <h3>–ü—Ä–æ –Ω–∞—Å</h3>
          <p>
            ProFix Network Hub ‚Äî –≤–∞—à –Ω–∞–¥—ñ–π–Ω–∏–π –ø–∞—Ä—Ç–Ω–µ—Ä —É —Å–≤—ñ—Ç—ñ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏—Ö
            –ø–æ—Å–ª—É–≥. –ú–∏ –æ–±‚Äô—î–¥–Ω—É—î–º–æ –¥–æ—Å–≤—ñ–¥ —ñ —ñ–Ω–Ω–æ–≤–∞—Ü—ñ—ó, —â–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –Ω–∞–π–∫—Ä–∞—â—ñ
            —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –≤–∞—à–æ–≥–æ –±—ñ–∑–Ω–µ—Å—É –≤ —Ä—ñ–∑–Ω–∏—Ö –≥–∞–ª—É–∑—è—Ö.
          </p>
        </div>
       
        <div class="footer-section">
          <h3>–ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
          <p>–¢–µ–ª–µ—Ñ–æ–Ω: +380 12 345 6789</p>
          <p>
            Email:
            <a
              href="/cdn-cgi/l/email-protection"
              class="__cf_email__"
              data-cfemail="254c4b434a654450514a494c4e44571711120b5044"
              >[email&#160;protected]</a
            >
          </p>
          <p>–ê–¥—Ä–µ—Å–∞: –º. –ö–∏—ó–≤, –≤—É–ª. –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∞, 24</p>
        </div>
      </div>
      <div class="copyright">
        &copy; 2024 ProFix Network Hub. –í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ.
      </div>
    </footer>

    <script
      data-cfasync="false"
      src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"
    ></script>
    <script>
      const themeToggle = document.getElementById("themeToggle");
      const htmlElement = document.documentElement;

      // Check for saved theme preference
      if (localStorage.getItem("theme") === "light") {
        htmlElement.classList.remove("dark");
        htmlElement.classList.add("light");
        themeToggle.checked = true;
      }

      // Toggle theme when switch is clicked
      themeToggle.addEventListener("change", function () {
        if (this.checked) {
          htmlElement.classList.remove("dark");
          htmlElement.classList.add("light");
          localStorage.setItem("theme", "light");
        } else {
          htmlElement.classList.remove("light");
          htmlElement.classList.add("dark");
          localStorage.setItem("theme", "dark");
        }

        // –û–Ω–æ–≤–ª—é—î–º–æ –≥—Ä–∞—Ñ—ñ–∫–∏ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ç–µ–º–∏
        initAgeChart();
        initUserMasterChart();
      });

      // Navigation buttons
      document
        .getElementById("profileBtn")
        .addEventListener(
          "click",
          () => (window.location.href = "profile.html")
        );
      document
        .getElementById("registerBtn")
        .addEventListener("click", () => (window.location.href = "auth.html"));
      document
        .getElementById("adminBtn")
        .addEventListener("click", () => (window.location.href = "admin.html"));

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –≤—ñ–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
      async function fetchAverageAge() {
        try {
          const response = await fetch("/api/average-age");
          if (!response.ok) {
            throw new Error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö");
          }
          return await response.json();
        } catch (error) {
          console.error("–ü–æ–º–∏–ª–∫–∞:", error);
          // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ, —è–∫—â–æ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ
          return { averageAge: "32.5" };
        }
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –≤—ñ–∫—É
      async function displayAverageAge() {
        const averageAgeElement = document.getElementById("averageAgeValue");
        const data = await fetchAverageAge();

        if (data && data.averageAge) {
          averageAgeElement.textContent = data.averageAge;
        } else {
          averageAgeElement.textContent = "N/A";
        }
      }

      // Age Demographics Chart
      async function fetchAgeData() {
        try {
          const response = await fetch("/api/age-demographics");
          if (!response.ok) {
            throw new Error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö");
          }
          return await response.json();
        } catch (error) {
          console.error("–ü–æ–º–∏–ª–∫–∞:", error);
          // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ, —è–∫—â–æ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ
          return [
            { category: "18-24", percentage: 15 },
            { category: "25-34", percentage: 35 },
            { category: "35-44", percentage: 25 },
            { category: "45-54", percentage: 15 },
            { category: "55+", percentage: 10 },
          ];
        }
      }

      async function initAgeChart() {
        const data = await fetchAgeData();

        if (!data) {
          document
            .querySelector("#ageChart")
            .closest(".chart-wrapper").innerHTML =
            '<p style="text-align: center; color: #ff3300;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö</p>';
          return;
        }

        const ctx = document.getElementById("ageChart").getContext("2d");

        // YouTube-like colors
        const colors = [
          "rgba(255, 0, 0, 0.7)", // Red
          "rgba(33, 150, 243, 0.7)", // Blue
          "rgba(76, 175, 80, 0.7)", // Green
          "rgba(255, 152, 0, 0.7)", // Orange
          "rgba(156, 39, 176, 0.7)", // Purple
          "rgba(0, 188, 212, 0.7)", // Cyan
          "rgba(233, 30, 99, 0.7)", // Pink
        ];

        const borderColors = colors.map((color) => color.replace("0.7", "1"));

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—î –≤–∂–µ –≥—Ä–∞—Ñ—ñ–∫ —ñ –≤–∏–¥–∞–ª—è—î–º–æ –π–æ–≥–æ
        if (window.ageChartInstance) {
          window.ageChartInstance.destroy();
        }

        window.ageChartInstance = new Chart(ctx, {
          type: "pie",
          data: {
            labels: data.map((item) => item.category),
            datasets: [
              {
                data: data.map((item) => item.percentage),
                backgroundColor: colors,
                borderColor: borderColors,
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "right",
                labels: {
                  color: htmlElement.classList.contains("light")
                    ? "#333"
                    : "#fff",
                  font: {
                    size: 14,
                  },
                  padding: 20,
                },
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.label}: ${context.raw.toFixed(1)}%`;
                  },
                },
              },
            },
          },
        });
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –º–∞–π—Å—Ç—Ä—ñ–≤ –∑ —á–∞—Å–æ–º
      async function fetchUserMasterTimelineData() {
        try {
          const response = await fetch("/api/user-master-timeline");
          if (!response.ok) {
            throw new Error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö");
          }
          return await response.json();
        } catch (error) {
          console.error("–ü–æ–º–∏–ª–∫–∞:", error);
          // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ, —è–∫—â–æ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ
          return [
            { month: "–°—ñ—á", users: 120, masters: 15 },
            { month: "–õ—é—Ç", users: 150, masters: 18 },
            { month: "–ë–µ—Ä", users: 200, masters: 22 },
            { month: "–ö–≤—ñ", users: 250, masters: 25 },
            { month: "–¢—Ä–∞", users: 300, masters: 30 },
            { month: "–ß–µ—Ä", users: 350, masters: 35 },
          ];
        }
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≥—Ä–∞—Ñ—ñ–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –º–∞–π—Å—Ç—Ä—ñ–≤
      async function initUserMasterChart() {
        const data = await fetchUserMasterTimelineData();

        if (!data) {
          document
            .querySelector("#userMasterChart")
            .closest(".chart-wrapper").innerHTML =
            '<p style="text-align: center; color: #ff3300;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö</p>';
          return;
        }

        const ctx = document.getElementById("userMasterChart").getContext("2d");

        // –ö–æ–ª—å–æ—Ä–∏ –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫–∞
        const userColor = htmlElement.classList.contains("light")
          ? "rgba(33, 150, 243, 0.7)"
          : "rgba(33, 150, 243, 0.7)";
        const masterColor = htmlElement.classList.contains("light")
          ? "rgba(255, 0, 0, 0.7)"
          : "rgba(255, 0, 0, 0.7)";

        const userBorderColor = userColor.replace("0.7", "1");
        const masterBorderColor = masterColor.replace("0.7", "1");

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—î –≤–∂–µ –≥—Ä–∞—Ñ—ñ–∫ —ñ –≤–∏–¥–∞–ª—è—î–º–æ –π–æ–≥–æ
        if (window.userMasterChartInstance) {
          window.userMasterChartInstance.destroy();
        }

        window.userMasterChartInstance = new Chart(ctx, {
          type: "line",
          data: {
            labels: data.map((item) => item.month),
            datasets: [
              {
                label: "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ",
                data: data.map((item) => item.users),
                backgroundColor: userColor,
                borderColor: userBorderColor,
                borderWidth: 2,
                tension: 0.3,
                fill: false,
                pointBackgroundColor: userBorderColor,
                pointRadius: 4,
              },
              {
                label: "–ú–∞–π—Å—Ç—Ä–∏",
                data: data.map((item) => item.masters),
                backgroundColor: masterColor,
                borderColor: masterBorderColor,
                borderWidth: 2,
                tension: 0.3,
                fill: false,
                pointBackgroundColor: masterBorderColor,
                pointRadius: 4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  color: htmlElement.classList.contains("light")
                    ? "#333"
                    : "#fff",
                  precision: 0,
                },
                grid: {
                  color: htmlElement.classList.contains("light")
                    ? "rgba(0, 0, 0, 0.1)"
                    : "rgba(255, 255, 255, 0.1)",
                },
              },
              x: {
                ticks: {
                  color: htmlElement.classList.contains("light")
                    ? "#333"
                    : "#fff",
                },
                grid: {
                  color: htmlElement.classList.contains("light")
                    ? "rgba(0, 0, 0, 0.1)"
                    : "rgba(255, 255, 255, 0.1)",
                },
              },
            },
            plugins: {
              legend: {
                position: "top",
                labels: {
                  color: htmlElement.classList.contains("light")
                    ? "#333"
                    : "#fff",
                  font: {
                    size: 12,
                  },
                  padding: 15,
                },
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.dataset.label}: ${context.raw}`;
                  },
                },
              },
            },
          },
        });
      }

      // Initialize charts and data when page loads
      document.addEventListener("DOMContentLoaded", () => {
        // –û—Ç—Ä–∏–º—É—î–º–æ —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —Å–µ—Ä–µ–¥–Ω—ñ–π –≤—ñ–∫
        displayAverageAge();

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –≥—Ä–∞—Ñ—ñ–∫–∏
        initAgeChart();
        initUserMasterChart();

        // –û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ä–º–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
        const orderForm = document.getElementById("orderForm");
        const orderFormMessage = document.getElementById("orderFormMessage");

        orderForm.addEventListener("submit", async function (e) {
          e.preventDefault();

          const submitBtn = document.getElementById("submitOrderBtn");
          submitBtn.disabled = true;
          submitBtn.textContent = "–í—ñ–¥–ø—Ä–∞–≤–∫–∞...";

          const title = document.getElementById("orderTitle").value;
          const description = document.getElementById("orderDescription").value;
          const phone = document.getElementById("orderPhone").value;

          // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π
          const userId = localStorage.getItem("userId");
          if (!userId) {
            orderFormMessage.textContent =
              "–ë—É–¥—å –ª–∞—Å–∫–∞, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏";
            orderFormMessage.className = "form-message error";
            submitBtn.disabled = false;
            submitBtn.textContent = "–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞—è–≤–∫—É";

            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏
            setTimeout(() => {
              window.location.href = "auth.html";
            }, 2000);
            return;
          }

          try {
            const response = await fetch("/orders", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                user_id: userId,
                title,
                description,
                phone,
              }),
            });

            const data = await response.json();

            if (response.ok) {
              orderFormMessage.textContent =
                "–ó–∞—è–≤–∫—É —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ! –ù–∞—à—ñ –º–∞–π—Å—Ç—Ä–∏ –∑–≤'—è–∂—É—Ç—å—Å—è –∑ –≤–∞–º–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.";
              orderFormMessage.className = "form-message success";
              orderForm.reset();
            } else {
              orderFormMessage.textContent =
                data.message || "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞—è–≤–∫–∏";
              orderFormMessage.className = "form-message error";
            }
          } catch (error) {
            console.error("–ü–æ–º–∏–ª–∫–∞:", error);
            orderFormMessage.textContent = "–ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º";
            orderFormMessage.className = "form-message error";
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = "–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞—è–≤–∫—É";

            // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
              orderFormMessage.style.display = "none";
            }, 5000);
          }
        });
      });
    </script>
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => {
            console.log('Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ –∑ –æ–±—Å—è–≥–æ–º:', registration.scope);
          })
          .catch(error => {
            console.log('–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è Service Worker –Ω–µ –≤–¥–∞–ª–∞—Å—è:', error);
          });
      }
    </script>
  </body>
</html>
